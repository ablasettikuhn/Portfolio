---
title: "Google Data Analytics Capstone Project: NBA Denver Nuggets Shots"
subtitle: "Alexandra Blasetti Kuhn"
output: html_document
runtime: shiny
owner: Alexandra Blasetti Kuhn
date: "2023-10-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\

# Ask Phase
<hr style="border: 1px solid black;">

## Introduction

The coach of the team want to understand the effect of some time and location conditionals on the shot conversion from 2015 to 2023.

Specifically, He wants to understand what’s the relationship between the time/location of the shot and the shot conversion from 2015 to 2023.

## Problem

what’s the relationship between minutes left, seconds left, distance shot and the shot conversion (efficiency rate) throughout the years? They decided to ask an external exercise science professional with Data analyst experience.

## Business Task

Business task: identify if minutes left, seconds left and distance shot are related to the shot conversion (efficiency rate) throughout the years 2015-2023.

## Hypothesis

Hypothesis: IF the minutes left, seconds left and distance shot* have an effect on shot conversion, THEN there is a relationship between these conditionals and the and the efficiency rate. This is the alternative hypothesis (H1), while the null hypothesis (H0) states that there is no relationship between the variables.
*these conditionals in the main hypothesis will be evaluated as H1, H2 and H3.

\

# Prepare Phase
<hr style="border: 1px solid black;">

## Data Sources

The data is provided directly from https://www.nba.com/stats It is public and accessible in the R package “ISAR”, data in nba_nuggets_shots.

The data set contains seven seasons of Denver Nuggets shot data from 2015 to 2023. It follows the ROCCC premises (the data is from a reliable organization, original, comprehensive, current, and cited)

Source: http://asbcllc.com/nbastatR/reference/teams_shots.html
Credits and owner: nba_nuggets_shots, ISAR package, NBA.

```{r, echo=FALSE}
library(ISAR)
library(tidyverse)
library(skimr)
```

## Variables and objects

Lets have a `glimpse(nba_nuggets_shots)` of the dataset. Other options are `str()` and `View()`

```{r, include=FALSE}
glimpse(nba_nuggets_shots)
```

The data set has 62,196 rows and 27 columns. It follows the ROCCC premises and is tidy, organized in long format. We are interested in the following variables: `yearSeason`, `minutesRemaining`, `secondsRemaining`, `distanceShot`, `isShotAttempted` and `isShotMade`. We are going to calculate the Efficiency Rate as `isShotMade/isShotAttempted` and store the result as the variable `EffRate` without adding it to the original database.

```{r}
EffRate <- nba_nuggets_shots$isShotMade/nba_nuggets_shots$isShotAttempted
```

The main coach and the data analyst agreed that the selected variables are appropriate for exploring the desired relationship, if there is any.

\

# Process Phase
<hr style="border: 1px solid black;">

## Data integrity and cleaning

Now we are going to check the NA's values on the database. We are only using 5 variables so we will select them.

```{r}
na_check <- nba_nuggets_shots %>% select(yearSeason, minutesRemaining, secondsRemaining, distanceShot, isShotAttempted, isShotMade) %>% is.na() %>% any()

ifelse(na_check==TRUE, "There are NA values in the selected columns.", "There are no NA values in the selected columns.")
```

Before starting any analysis, let's explore the objects inside the variables we want to consider. We can use the `unique()` function on each variable or the `distinct()` function and the %>%

```{r}
nba_nuggets_shots %>% distinct(yearSeason)
unique(nba_nuggets_shots$yearSeason)
unique(nba_nuggets_shots$minutesRemaining)
unique(nba_nuggets_shots$secondsRemaining)
unique(nba_nuggets_shots$distanceShot)
unique(nba_nuggets_shots$isShotAttempted)
unique(nba_nuggets_shots$isShotMade)
```

To pull out a brief summary of the variables we want to analyze, `summary()` or `skim()` functions are both good options. With the skim function we have a visual idea of the data distribution. The Visualizations were examined with hist() function too.

```{r}
nba_nuggets_shots %>% select(yearSeason, minutesRemaining, secondsRemaining, distanceShot, isShotAttempted, isShotMade) %>% skim()
```

_After reviewing and testing the data, we can conclude the data is tidy, organized in long format and there are no NA’s. The EDA-Exploratory data analysis shows that the data does not follow a normal distribution._

\

# Analyze Phase
<hr style="border: 1px solid black;">

## Hypothesis testing: Spearman's Rank Correlation Analysis

Considering that the data is NOT normally distributed, H1, H2 and H3 are tested with the Spearman's Rank Correlation Coefficient.

**H1: IF the minutes left have an effect on shot conversion, THEN there is a relationship between minutes remaining and the efficiency rate. H0: There is no relationship between the variables.**

We are going to perform the correlation test between minutes remaining and efficiency rate and store the results as H1:

```{r}
H1 <- cor.test(nba_nuggets_shots$minutesRemaining, EffRate, method = "spearman")
H1
```

**Conclusion H1/H0**

Based on the Spearman's rank correlation analysis, there is a statistically significant correlation between the variables `minutesRemaining` and `EffRate` (rho = 0.0196, p < 0.001). The positive correlation coefficient (rho) suggests a weak positive monotonic relationship between the remaining minutes in a basketball game and the efficiency rate. (warning: correlation does not mean causation).

The large test statistic (S = 3.9314e+13) provides strong evidence against the null hypothesis H0. This means that the observed correlation is unlikely to be due to random chance. We reject H0 and accept H1.

In practice, the analysis suggests that as the remaining minutes in a basketball game increase, there is a tendency for the efficiency rate to also increase, although the relationship is weak. 

<!--This information can be valuable for basketball teams and coaches in understanding the dynamics of the game and making strategic decisions based on the remaining time and efficiency rate.-->

\

**H2: IF the seconds left have an effect on shot conversion, THEN there is a relationship between seconds remaining and the efficiency rate. H0: There is no relationship between the variables.**

We are going to perform the correlation test between seconds remaining and efficiency rate and store the results as H2:

```{r}
H2 <- cor.test(nba_nuggets_shots$secondsRemaining, EffRate, method = "spearman")
H2
```

**Conclusion H2/H0**

Based on the Spearman's rank correlation analysis, there is a statistically significant correlation between the variables `secondsRemaining` and `EffRate` (rho = 0.0175, p < 0.001). The positive correlation coefficient (rho) suggests a weak positive monotonic relationship between the remaining seconds in a basketball game and the efficiency rate. (warning: correlation does not mean causation).

The large test statistic (S = 3.9396e+13) provides strong evidence against the null hypothesis H0. This means that the observed correlation is unlikely to be due to random chance. We reject H0 and accept H2.

In practice, the analysis suggests that as the remaining seconds in a basketball game increase, there is a tendency for the efficiency rate to also increase, although the relationship is weak. 

<!--This information can be valuable for basketball teams and coaches in understanding the dynamics of the game and making strategic decisions based on the remaining time and efficiency rate.-->

\

**H3: IF the distance shot has an effect on shot conversion, THEN there is a relationship between the distance shot and the efficiency rate. H0: There is no relationship between the variables.**

We are going to perform the correlation test between distance shot and efficiency rate and store the results as H3:

```{r}
H3 <- cor.test(nba_nuggets_shots$distanceShot, EffRate, method = "spearman")
H3
```

**Conclusion H3/H0**

Based on the Spearman's rank correlation analysis, there is a statistically significant correlation between the variables `distanceShot` and `EffRate` (rho = -0.2441, p < 0.001). The positive correlation coefficient (rho) suggests a weak negative monotonic relationship between the distance shot in a basketball game and the efficiency rate. (warning: correlation does not mean causation).

The large test statistic (S = 4.989e+13) provides strong evidence against the null hypothesis H0. This means that the observed correlation is unlikely to be due to random chance. We reject H0 and accept H3.

In practice, the analysis suggests that as the distance shot in a basketball game decreases, there is a tendency for the efficiency rate to increase, although the relationship is weak. 

> Note: Considering the main hypothesis and the correlation coefficient obtained in minutes remaining, seconds remaining and distance shot, we can conclude that although all variables are related to the Efficiency Rate, the distance shot has a higher correlation on the efficiency rate than the other two time conditionals. In the share phase, we will focus the visualizations in distance shots as it's an important variable that the main coach can control and train.

> This information can be valuable for basketball teams and coaches in understanding the dynamics of the game and making strategic decisions based on the remaining time/location variables of the shot and the efficiency rate.

## Just for curiosity

The data analyst decided to test Pearson's Correlation Coefficient despite the data is not normally distributed just for curiosity.This decision to test Pearson's Correlation Coefficient despite the not normal distribution, yielded surprising outcomes. This highlights the importance of exploring relationships between variables even in non-ideal conditions and being open to unexpected findings.

```{r}
cor.test(nba_nuggets_shots$distanceShot, EffRate, method = "pearson")
cor.test(nba_nuggets_shots$minutesRemaining, EffRate, method = "pearson")
cor.test(nba_nuggets_shots$secondsRemaining, EffRate, method = "pearson")
```

The p-value obtained from the 3 tests are less than the significance level of 0.001, providing strong evidence against the null hypothesis H0. Therefore, there is a statistically significant relationship between the variables. Although the Pearson's correlation coefficients are small in magnitude, they are still statistically significant. This means that even though the relationship between the variables is weak, it is unlikely to have occurred by chance.

The surprise: The Pearson's correlation coefficient obtained for H1, H2 and H3 are similar in magnitude and value to the estimated Spearman's correlation coefficients. This indicates a weak positive relationship between Efficiency rate and minutes and seconds left, and a weak negative relationship between Efficiency Rate and distance shot.

\

# Share Phase
<hr style="border: 1px solid black;">

## Visualizations

## Boxplot: Distribution of Distance Shot by Efficiency Rate

```{r}
ggplot(nba_nuggets_shots, aes(x = distanceShot, y = isShotMade, fill = isShotMade)) + geom_boxplot() + stat_summary(fun = mean, geom = "point", shape = 23, size = 2.5, fill = "black", position = position_dodge(width = 0.75)) + scale_fill_manual(values = c("tomato", "palegreen")) + labs(x = "Distance Shot", y = "Is Shot Made", fill = "Is Shot Made?") + ggtitle("Distribution of Distance Shot by Efficiency Rate")
```

> The boxplot above shows the distribution of shot distances based on the efficiency rate. The boxes represent the interquartile range (0.25 to 0.75 percent of the observations), filled in green for shots made and red for shots missed. The vertical line inside the box represents the median (0.50 of the observations). The black diamond represents the mean. The mean for shots missed is below the median and the mean for shots converted is above the median. The means are relatively similar, but the median for shots missed is higher than the median for shots converted, indicating that shots converted tend to be in shorter distances, while shots missed tend to be in longer distances. The black points represent outliers, with more shots missed in long distances and a few shots converted in long distances.
 
\
 
## Barplot: Distribution of Minutes Left by Efficiency Rate

```{r}
ggplot(nba_nuggets_shots, aes(x = minutesRemaining, fill = isShotMade)) + geom_bar(stat = "count") + scale_fill_manual(values = c("tomato", "palegreen")) + labs(x = "Minutes Remaining", y = "Count", fill = "Is Shot Made?") + ggtitle("Distribution of Minutes Left by Efficiency Rate")
```

> The barplot above shows the distribution of minutes remaining based on the efficiency rate. The bars represent the count of shots converted in green and shots missed in red, based on the minutes left. The first tall bar shows a higher number of shots missed when there is 1 minute left. The last two bars show a smaller number of shots missed when there are 11 minutes left and all shots missed when the game quarter starts (12 minutes left).

\

## Barplot: Distribution of Seconds Left by Efficiency Rate

```{r}
ggplot(nba_nuggets_shots, aes(x = secondsRemaining, fill = isShotMade)) + geom_bar(stat = "count") + scale_fill_manual(values = c("tomato", "palegreen")) + labs(x = "Seconds Remaining", y = "Count", fill = "Is Shot Made?") + ggtitle("Distribution of Seconds Left by Efficiency Rate")
```

> The barplot above shows the distribution of seconds remaining based on the efficiency rate. The bars represent the count of shots converted in green and shots missed in red, based on the seconds left. The first tall bar shows a higher number of shots missed when there are between 1 and 1.5 seconds left. also, the shots made are higher when there are between 1 and 1.5 seconds left. The last bar shows there are no shots when the game countdown clock starts (60 seconds left).

\

## Dashboard: boxplot of distance shot and efficiency rate by year

```{r}
ggplot(nba_nuggets_shots, aes(x = distanceShot, y = isShotMade, fill = isShotMade)) + geom_boxplot() + stat_summary(fun = mean, geom = "point", shape = 23, size = 2, fill = "black", position = position_dodge(width = 0.75)) + scale_fill_manual(values = c("tomato", "palegreen")) + labs(x = "Distance Shot", y = "Is Shot Made", fill = "Is Shot Made?") + ggtitle("Distribution of Distance Shot by Efficiency Rate") + facet_wrap(~yearSeason, ncol=3)
```

The main coach wants to see the changes throughout the years, however, this visualization can be simplified. We are going to create an interactive dashboard to better understand the box plots of distance shot and efficiency rate from 2015 to 2023.

## Interactive Dashboard created with shiny

First we need to define the UI:

```{r}
library(shiny)
ui <- fluidPage(
titlePanel("Interactive Dashboard"),
sidebarLayout(
sidebarPanel(
sliderInput("year", "Select Year", min = min(nba_nuggets_shots$yearSeason),
max = max(nba_nuggets_shots$yearSeason), value = min(nba_nuggets_shots$yearSeason),
step = 1)
),
mainPanel(
plotOutput("plot")
)
)
)
```

Second we need to define the server logic and third run the shinyApp: `shinyApp(ui, server)`. By defining `runtime: shiny` in the YAML, the dashboard is displayed in the html document.

```{r}
server <- function(input, output) {
  output$plot <- renderPlot({
    filtered_data <- nba_nuggets_shots[nba_nuggets_shots$yearSeason == input$year, ]
    ggplot(filtered_data, aes(x = distanceShot, y = isShotMade, fill = isShotMade)) +
      geom_boxplot() + stat_summary(fun = mean, geom = "point", shape = 23, size = 2, fill = "black", position = position_dodge(width = 0.75)) +
      scale_fill_manual(values = c("tomato", "palegreen")) +
      labs(x = "Distance Shot", y = "Is Shot Made", fill = "Is Shot Made?") +
      ggtitle("Distribution of Distance Shot by Efficiency Rate") +
      facet_wrap(~yearSeason, ncol = 3)
  })
}
shinyApp(ui, server)
```

> The slidebar selects the desired year throughout the years 2015 to 2023. We can now see the distribution of distance shot and efficiency rate for each year. To understand the dashboard by year, recall that 1) The boxes represent the interquartile range (0.25 to 0.75 percent of the observations), filled in green for shots made and red for shots missed. 2) The vertical line inside the box represents the median (0.50 of the observations). The black diamond represents the mean. 3) The black points represent outliers, with more shots missed in long distances and a few shots converted in long distances.

\

# Act Phase
<hr style="border: 1px solid black;">

## In summary

* The business task was performed and analyzed based on the problem that the main coach wanted understand. The relation between minutes left, seconds left, distance shot and Efficiency Rate was successful measured and analyzed.

* The main hypothesis was confirmed, there is a relationship between minutes remaining, seconds remaining, distance shot and the efficiency rate. Although all variables are related to the Efficiency Rate, the distance shot has a higher correlation on the efficiency rate than the other two time conditionals.

* This information can be valuable for all nba basketball teams and coaches as it can lead to further research. Understanding the conditionals of the game is a powerful decision-making strategy. In this particular case study the time/location variables of the shot were analyzed and related to the efficiency rate.

* The period of time taken was from 2015 to 2023 but the purpose of the coach was not to analyze the years separately. This can be performed as part of a new business task if the main focus changes to differences between the 2015 to 2023 seasons.

* In the share phase, the visualizations were focused on distance shots as it's an important variable that the main coach can control and train. Dashboards for minutes and seconds remaining can be included as part of a redefinition of the business task.
